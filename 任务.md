
# 任务3月2日 总加班时间：3小时
* PS新flat补偿编码 + 测试         1.0
* 脉冲软件新flat补偿编码 + 测试     0.0 + 1.0 
* 4通道辐射源打包exe系统兼容修复    0.0 + 0.0 + 1.0 + 0.5
* 4通道pcie通信验证+测试          0.0 + 0.0 + 0.0 + 0.5 + 1.0 + 1.0


## 3U 平坦度校准逻辑
方法1-YWC att2 % 128 = 最大可减值 （1=0.25db），先看能减多少
方法2-输入功率5dBm，输入是0dBm，掉了5db，所以输入+差值 = 10dBm，去发10dBm的值，缺点：输入+差值> 10的都补不了

* 最终补偿方法：
* 前提条件：flat_sw on, mod on, 调频信号on
* 1-计算输入功率可补偿值（in_can_add_power）= 最大功率（max_power）10 - 输入功率（in_power）
* 2-计算第一次差值 res_power = in_can_add_power - 需补偿值（flat_power）
* 3-if res_power >= 0 直接下发 (in_power + flat_power)查表的att1，att2 + 6，功率向下取整然后计算小数部分差值，查表数字中频然后下发
* 4-if res_power < 0  先查找10的att1，att2 + 6
* 5-计算第二次差值 res_power = abs(res_power)
* 6-if res_power < 3.5，直接查表数字中频下发
* 7-if 3.5 < res_power < 4.5，用计算公式计算需要补偿的值 3.5的数值中频 - 3 * （2的16次方）找彭飞要一下公式
* 8-if res_power > 4.5，先下发第7步计算的数字中频
* 9-计算第三次差值res_power = res_power - 4.5
* 10-计算att2可衰减值（att2_can_del_power） = (att2 + 6) % 128 * 0.25
* 11-if att2_can_del_power > res_power, 直接下发att2 + 6 - res_power
* 12-if att2_can_del_power < res_power, 则减去最大值，下发att2 = att2 - att2_can_del_power

## 3U2G问题

* 第三步：如果还剩余1个dBm没有补，则查找if_diff_num的表格，最多到350，然后把这个中频值发下去即可

## 功率校准  --√
* 校准逻辑：
  根据频率选文件，然后根据射频衰减值选对应行，再然后将中频衰减值加到对应行数据的第二列，得到的数据就是要传输的数据。
  中频衰减值的实际衰减值的4倍。譬如中频衰减设定7，衰减3.5dB，则需要在第二列加的值是14。
  射频衰减4 就是1db 然后就是找第5行  取第五行的0列和1列 + 14（中频衰减值是7） 发送到204 高16位和低16位

* 方法1：遍历发送益为创的表格，然后读取功率，看对应的关系是啥，然后直接查新表，百兆校准
* 方法2: 10M校准，然后拿到最优质，查衰减值再去查益为创表格，但是要提前测试我们的衰减10是否对应益为创的11行的值，
  * 如果不是，还要遍历找到对应关系才可以
* 功率校准更改以后对功率计校准是否有影响
* 添加查询最优质方法，步进为1个dbm，然后衰减查表的时候就是0，4，8对应表格的0行1行
* 上位机新添加：10M步进遍历功能，例如690M以下没10M步进，都发送600M文件里的数据，拿到功率值，形成一个表格

* 方法3：功率计校准，模式YWC的表就是对的，射频发0-4-8-12，查找YWC的表格0-4-8-12
  * 上位机查表，0的时候查0行，4查1行，8查2行，12查3行，依次类推  --√ 待测试
  * PS合并功率计版本
  * 上位机复测1和复测2都要添加YWC文件功能

## 2G带宽脉冲软件更改
* 边界更改
  * 问题1：toa怎么下发，直接更改分辨率是否可以
* 捷变方式与前面板一致，改成随机/正弦/线性 捷变频添加随机按钮 默认时线性，10-100M 11个点，随机就是把这11个点随机发送下去
* 计算公式更改
* 捷变频每一个频点的功率，周期，脉宽和重复脉冲数都可以单独设置
* 参差的脉组数都可以单独设置 32个周期设置32个脉组数
* PDW导入功能--暂时不做

* 上位机  --√
  * 10M-20G  10M一个点校准 
  * 数控衰减
  * 10M-2.5G： 第四个通道只校准0和1  dat1（0-63） dat4（1）  dat1（0-63） dat4（0） dat2（0-63） dat3（0-63）
  * 2.5G以上：dat1（0-63） dat2（0-63） dat4（0-40） dat3（0-50）
  * 频谱仪ref设置
  * 10M-2.5G: dat1(0-63) dat4(1): 25    dat1(0-63) dat4(0): 10  dat2(0-63): -10  dat3(0-63): -30
  * 2.5G以上：dat1(0-63): 25  dat2(0-63): -10  dat4(0-40):-35 dat3(0-50):-40
  * 频点延时
  * 10M-2.5G: 切通道前两个点1s，其它50ms
  * 2.5G以上：切通道前3个点1s，其它80ms
