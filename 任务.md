----------8月份任务------------------
# 3U前面板开发 8月7号开始
* 说是之前硬件的同事一个月就写完了

## 移植 --建珩
* 配置引脚
* 移植LVGL
* 移植FreeRTOS
* 串口可以先不移植

## 写代码 

--------临时任务--------- python 功率计上位机软件开发
### 1-界面1
* -->2U发送校准指令
* -->2U设置开始频率，结束频率/功率/衰减器初值（默认值）
* -->设置功率计的功率
* -->读取功率计想读应频率的功率，并加上线损功率，是一个范围
* -->判断该功率与设置的功率插值是否小于等于0.01db
  * -->是，读取AD等4个值写进文件
    * -->判断功率是否为最小功率
      * 否-->+0.01db 设置功率值
      * 是-->判断频率是否为停止值
        * 是-->结束
        * 否-->重新设置频率功率 进入循环

## 功率计校准软件协议
* 包头 7e 7e 10(控制模式) 数据长度（配置参数+参数值+e7（包尾））+配置参数 + 参数值 + 包尾
* 设置工作模式 7e 7e 10 03 01 00 e7
* 设置校准模式 7e 7e 10 03 01 01 e7

* 设置频率     7e 7e 10  len(02 + data + e7)  02 data e7   data:9k-40G len:8
* 设置功率     7e 7e 10  len(03 + data + e7)  03 data e7   data:-10~15 / -10~13 len: 4
* 设置衰减量1  7e 7e 10  len(04 + data + e7)  04 data e7   data:0-63 len:1
* 设置衰减量2  7e 7e 10  len(05 + data + e7)  05 data e7   data:0-63 len:1
* 设置压控DA值 7e 7e 10  len(06 + data + e7)  06 data e7   data:     len:2
* 读取检波器AD 7e 7e 10  len(07 + data + e7)  07 data e7   data:     len:2
* 读取温度     7e 7e 10  len(08 + data + e7)  08 data e7   data：    len:2
* 读取DDS     7e 7e 10  len(09 + data + e7)  09 data e7   data:     len:2
* 读取FLASH   7e 7e 10  len(0a + data + e7)  0a data e7   data:15-1b len: 2 20 len:1
* 操作flash   7e 7e 10  len(0b + data + e7)  0b data e7
  * data: 1B 00000000 0位为1 当前状态写入flash 自动清0
  * 1位为1 读取当前频率和功率下的校准数据，并赋值给寄存器15-17 后自动清0
  * 2位为1 清除flash
  * 3位位1 再不改变之前的校准数据下，修改当前频点的校准值
* 功率计在设置2U频率的时候 也需要设置一下功率计的频率 然后再读取功率计的功率
  * FREQ 500khz 设置频率
  * FETC2?       读取CALCulate2的测量值
  * 
  
## 2U返回值
* 7e7e + 10 + 数据长度（同写） + 功能码 + 00：成功 01：失败 02：异常 + data + e7

* 一个频点一个频点的校准 以10m为步进

## 2U遗留问题
* 选中框 按哪个按键 就显示哪个选中框 没有找到底层选中框的位置

## 校准软件c版本问题
* 频段判断的位置有一个地方写错


# 3U-PS修改+功能添加
* 1：修改初始化loop_type状态，默认为2，实际应该为1  --√ 已修改且添加
* 2：添加uart接收文件指令代码                    --√ 添加完毕  
* 3：添加usb功能，没有rename功能
  * 加载，删除，扫描csv                         --√ 
* 4：读取文件大小，读取文件修改时间                --√
* 5: 前面板列表模式，非列表模式不可以读文件
* 6：usb路径:/run/media/sda1 是否写死？只做单层不做分区，可以看到所有的文件，所以直接读就可以了
* 7：读取这个路径读到的是什么？ 答：可以直接读取usb文件路径
* 8：通信部分，如何更新到前面板？直接发送给前面板     --√
* 9：State文件存储和加载                       --√
* 10：捷变频列表数据，按照set_agility_dma_line这个函数直接发即可，一个频率，一个功率，就是没有step了，直接调用
  * 函数即可
* 11：前面板把捷变频的LIST判断打开，包括PS端的     --√
* 12：脉冲生成软件，qt版也要做一下更改，把600判断改成和ps一样的

# 3U问题
* 1-第一次远程连接的时候，指令丢失，需要加延时  --200e3 延迟 只显示9个文件，但是向前发了14个加大延时也没用
* 2-Last Next   --√
* 3-切换type的时候，文件列表没切换，显示的文件混乱，需要再看一下  --√
* 4-显示时机更改--不能用动态显示，要改成静态显示  --√
  * 逻辑更改：ps端定时检测usb是否在线，第一次上线同步文件数据，下线清空，再上线则同步 --√
    *       stm端保存全部文件，根据当前type显示切换显示文件，不从u盘读取，而是从文件列表直接显示
    *       根据不同文件type计算文件no，什么时候开始计算
* 5-save没写界面部分，recall加载的文件也是混乱的   --√
  * save界面要清除文件面板
  * 重新进入save界面要把files_info里的state文件全部删除 
* 6-recall save file界面切换死机，应该是state有一个文件导致进入死循环了  --√
  * 多加一层判断，如果file_no == all_file_no；把while break掉
* 7-ps端state的no没有++，发送的一直是1_STATE.CSV  --√

* 8-前面板第二次进入save界面的时候，state文件没有删除掉       --√  
  * 原因:用for进行删除的时候，数据向上移动，4->3，所以之前的4也就是现在的3会被跳过
* 9-前面板进入save界面的时候，ps端也要把csv文件全部删除才可以同步    --√
* 文件列表切换聚焦的时候，数据会变错误 --√
* 10-文件下一页显示的不对，find_file_no=file_no才可以 --√
* 8-捷变频列表文件是一个频率一个功率的存放格式 --√
* 9-更改完IP以后连接不上，前面板显示0.0.0.0  --√
* 10-ps端 state和usb的加载要分开写         --√
* 11-加载state文件死机  --√
* 12-save文件重新按加载的时候 没有删除干净 --√

* 13-ps/stm/上位机 正弦滑变：pri = pri + pri x 滑变范围（小数） / 2 * sin((i - 1 / n * 2pi))
  * stm 更改完成 待测试  --√
  * 上位机 --√
  * ps  --√

* 14—ps端加载校准文件找的if_attr是错误的  --√ 文件生成格式和大小判断有问题，先写成固定的
  * 计算方式 通过频率 功率 找到第三列 第四列的值 att，if_att，然后通过第五列找 if_cal里的第二列的值，然后
  * 读取第三列的值，如果有小数部分，找到小数部分加或者减，然后发下去

* 15-ps端加载校准文件和查表函数更改  --空了再写
* 16-上位机捷变频大小判断 --√ 待测试
* 17-上位机frank的相数和PDW的码元数生成的是0 bug修复  --✔
* 18-第一次远程remote以后，参数没有发过来，需要加延时

# 2U问题
* pulse列表设定延迟和重复次数以后，把列表输出打开，然后按trigger，第一次有信号输出，再按就没了
* pulse的外部触发不管用


# 打分机制
* 比重分三块：任务完成度（60%），任务饱和度（20%），工作态度（20%）
* 任务完成度：是否都完成了，未完成最多打分到0.8，也就是48分，按照任务完成度（每个任务有比重）
* 任务饱和度：上班时间达到规定时间，2个周六+10小时。上班时间/总时间*比例=分数
* 工作态度：迟到早退，积极性。